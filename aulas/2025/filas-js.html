<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Trabalhando com filas</title>

		<link rel="stylesheet" href="../../dist/reset.css">
		<link rel="stylesheet" href="../../dist/reveal.css">
		<link rel="stylesheet" href="../../dist/theme/white.css">

		<link rel="stylesheet" href="../../plugin/highlight/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Trabalhando com Filas</h1>
					<p class="fragment" style="font-size: 4rem;"> Um sempre <strong>atr√°s</strong> do outro </p>
				</section>


				<section><h2>Quem sou eu?</h2></section>

				<section>
					<div style="display: flex;">
						<div>
							<h3>Alessandro Feitoza</h3>

							<ul style="font-size: 2rem">
								<li class="fragment">Professor de c√≥digos e outras computarias</li>
								<li class="fragment">Programador/Dev/Severino</li>
							</ul>
						</div>
						<div>
							<img width="60%" src="../../img/slide-dev-jornada/ale.jpg" alt="">
						</div>
					</div>
				</section>

				<!--
				<section>
					<div style="display: flex;">
						<div>
							<ul style="font-size: 2rem">
								<li class="fragment">+12 anos como Dev</li>
								<li class="fragment">+12 anos como professor de devs</li>
								<li class="fragment">J√° fui contratado, demitido, readimitido</li>
								<li class="fragment">J√° contratei, j√° desliguei pessoas</li>
								<br>
								<li class="fragment">E nenhuma dessas coisas eu fiz direito ü¶Ü </li>
							</ul>
						</div>
						<div>
							<img class="fragment" width="80%" src="../../img/gifs/pato.gif" alt="">
						</div>
					</div>
				</section>
				-->


				<section>
					<h1>Contexto</h1>
                    <p class="fragment">Uma aplica√ß√£o web, como qualquer outra</p>
				</section>

                <section>
                    <img src="../../2024/img/filas/request_01.png" alt="">
                </section>

                <section>
                    <img src="../../2024/img/filas/request_02.png" alt="">
                </section>

                <section data-background="#333">
                    <p style="font-size: 4rem;">
                        Nesse cen√°rio altamente comum, <strong>um processo depende do outro</strong>
                    </p>
                </section>

                <section>
                    <img src="../../2024/img/filas/request_03.png" alt="">
                    <p class="fragment">Isso aqui pode ser um problema?</p>
                </section>

                <section data-background="#333">
                    <h3>A arquitetura em camadas n√£o √© um problema!</h3>
                    <p class="fragment">O problema √© a third party</p>
                </section>
                <section>
                    <img src="../../2024/img/filas/request_04.png" alt="">
                </section>

                <section>
                    <img src="../../2024/img/filas/request_05.png" alt="">
                </section>

                <section data-background="#333">
                    <p>Solu√ß√£o</p>
                    <h3 class="fragment">Terceiriza</h3>
                </section>

                <section>
                    <img src="../../img/gifs/fila.webp" alt="">
                </section>

                <section data-background="#333">
                    <h2>PILHA </h2> VS <h2> FILA</h2>
                </section>

                <section>
                    <img src="../../2024/img/filas/pilha.png" alt="">
                    <br>
                    <p>
                        Last In, First Out
                    </p>
                </section>

                <section>
                    <img src="../../2024/img/filas/fila.png" alt="">
                    <br>
                    <p>
                        First In, First Out
                    </p>
                </section>

                <section>
                    <h3>O que s√£o filas?</h3>
                    <ul>
                      <li class="fragment">Mecanismo para processar tarefas em background</li>
                      <li class="fragment">Evita sobrecarga no fluxo principal da API</li>
                      <li class="fragment">Permite escalabilidade horizontal</li>
                    </ul>
                  </section>

                  <section>
                    <h3>Por que usar filas em Node.js?</h3>
                    <ul>
                      <li class="fragment">Desacoplar tarefas pesadas</li>
                      <li class="fragment">Melhorar tempo de resposta</li>
                      <li class="fragment">Garantir retries em caso de falha</li>
                      <li class="fragment">Processar tarefas de forma paralela</li>
                    </ul>
                  </section>
          
                  <section>
                    <h3>Principais bibliotecas</h3>
                    <ul>
                      <li class="fragment"><b>Bull / BullMQ</b> (baseado em Redis, mais popular)</li>
                      <li class="fragment"><b>Agenda</b> (baseado em MongoDB)</li>
                      <li class="fragment"><b>Bee-Queue</b> (leve e r√°pido, tamb√©m usa Redis)</li>
                    </ul>
                </section>

                <section>
                    <h3>Exemplo pr√°tico (BullMQ)</h3>
                    <pre><code class="language-js">
          // fila.js
          import { Queue } from "bullmq"
          const filaEmail = new Queue("emails", { connection: { host: "localhost", port: 6379 } })
          await filaEmail.add("enviarEmail", { para: "teste@email.com" })
          
          // worker.js
          import { Worker } from "bullmq"
          new Worker("emails", async job => {
            console.log("Enviando email para:", job.data.para)
          })
                    </code></pre>
                  </section>
          
                  <section>
                    <h3>Exemplos de uso</h3>
                    <ul>
                      <li class="fragment">Envio de e-mails e notifica√ß√µes</li>
                      <li class="fragment">Processamento de uploads (imagens, v√≠deos)</li>
                      <li class="fragment">Gera√ß√£o de relat√≥rios pesados</li>
                      <li class="fragment">Integra√ß√µes com APIs externas</li>
                    </ul>
                  </section>
          
                  <section>
                    <h3>Pr√≥s</h3>
                    <ul>
                      <li class="fragment">Escalabilidade</li>
                      <li class="fragment">Resili√™ncia a falhas</li>
                      <li class="fragment">Melhor UX (resposta r√°pida)</li>
                      <li class="fragment">Retries autom√°ticos</li>
                    </ul>
                  </section>
          
                  <section>
                    <h3>Contras</h3>
                    <ul>
                      <li class="fragment">Mais complexidade na arquitetura</li>
                      <li class="fragment">Necessidade de servi√ßos adicionais (Redis)</li>
                      <li class="fragment">Monitoramento e observabilidade mais dif√≠ceis</li>
                      <li class="fragment">Custo extra de infraestrutura</li>
                    </ul>
                  </section>
          
                  <section>
                    <h3>Pontos para discuss√£o</h3>
                    <ul>
                      <li class="fragment">Quando usar filas e quando √© overengineering?</li>
                      <li class="fragment">Redis ou outro backend (SQS, RabbitMQ, Kafka)?</li>
                      <li class="fragment">Fila interna x servi√ßos externos</li>
                      <li class="fragment">Escalabilidade de workers</li>
                    </ul>
                  </section>
          

                <section>
                    <img src="../../2024/img/filas/request_07.png" alt="">
                </section>

                <section data-background="#333">
                    <ul>
                        <li class="fragment">Jobs</li>
                        <li class="fragment">Job Batches</li>
                        <li class="fragment">Failed Jobs</li>
                    </ul>
                </section>



				<section>
                    <h2>Ferramentas e Nomenclaturas</h2>
                    <p>Jobs, Queues, Notifications, Eventos e Task Scheduling</p>
                    </section>
                    
                    
                    <section>
                    <h3>Por que usar?</h3>
                    <ul>
                    <li class="fragment">Escalabilidade</li>
                    <li class="fragment">Organiza√ß√£o de responsabilidades</li>
                    <li class="fragment">Melhor experi√™ncia do usu√°rio</li>
                    </ul>
                    </section>
                    
                    
                    <section>
                    <h3>Jobs & Workers & Queues</h3>
                    <p class="fragment">Processos pesados em background</p>
                    </section>

                    <section>
                        <img src="img/filas.png" alt="">
                    </section>
                    
                    
                    <section>
                    <h3>Criando um Job</h3>
                    </section>
                    
                    
                    <section>
                    <h3>Exemplo de Job</h3>
                    <pre><code data-trim data-noescape>
                    class ProcessarPedido {
                         function handle() {
                            // L√≥gica de processamento
                        }
                    }
                    </code></pre>
                    </section>

                    <section>
                        <h3>Disparando o Job</h3>
                        <pre><code data-trim data-noescape>
                        ProcessarPedido.dispatch(pedido);
                        </code></pre>
                        </section>
                        
                        
                        <section>
                        <h3>Configura√ß√£o da Queue</h3>
                        <ul>
                        <li class="fragment">database</li>
                        <li class="fragment">redis</li>
                        <li class="fragment">sqs</li>
                        </ul>
                        </section>
                        
                        
                        <section>
                        <h3>Rodando o worker</h3>
                        </section>
                        
                        
                        <section>
                        <h3>Notifications</h3>
                        <p class="fragment">Comunica√ß√£o r√°pida e multi-canal</p>
                        </section>

                        <section>
                            <h3>Criando uma Notification</h3>
                            </section>
                
                
                <section>
                <h3>Exemplo de Notification</h3>
                <pre><code data-trim data-noescape>
                class PedidoEnviado {    
                    public function toMail() {
                        return (new MailMessage)
                            .subject('Seu pedido foi enviado!')
                            .line('Confira os detalhes no sistema.');
                    }
                }
                </code></pre>
                </section>
                
                
                <section>
                <h3>Disparando Notification</h3>
                <pre><code data-trim data-noescape>
                user.notify(new PedidoEnviado());
                </code></pre>
                </section>
                
                
                <section>
                <h3>Eventos & Listeners</h3>
                <p class="fragment">Desacoplamento de a√ß√µes</p>
                </section>
                
                
                <section>
                <h3>Criando Evento</h3>
                </section>
                
                
                <section>
                <h3>Criando Listener</h3>
                </section>
                
                
                <section>
                <h3>Exemplo Listener</h3>
                <pre><code data-trim data-noescape>
                class EnviarEmailConfirmacao {
                    function handle(event) {
                        Mail.to(event.user).send(...);
                    }
                }
                </code></pre>
                </section>
                
                
                <section>
                <h3>Task Scheduling</h3>
                <p class="fragment">Tarefas autom√°ticas no cron</p>
                </section>
                
                
                <section>
                <h3>Definindo Schedule</h3>
                <pre><code data-trim data-noescape>
                function schedule(schedule) {
                    schedule.command('pedidos:limpar').daily();
                }
                </code></pre>
                </section>
                
                
                <section>
                <h3>Rodando o Scheduler</h3>
                <pre><code data-trim data-noescape>
                * * * * * npx schedules.js schedule:run >> /dev/null 2>&1
                </code></pre>
                </section>
                
                
                <section>
                <h2>Boas Pr√°ticas</h2>
                <ul>
                <li class="fragment">N√£o sobrecarregar Controllers</li>
                <li class="fragment">Usar Services e Listeners</li>
                <li class="fragment">Testar Jobs isoladamente</li>
                </ul>
                </section>
                
                <section>
                    <h3>Comparando com outras linguagens</h3>
                    <ul>
                      <li class="fragment"><b>Node.js (Express)</b> ‚Äì Excelente em I/O, r√°pido para enfileirar, workers podem escalar horizontalmente, dependente de Redis/Kafka/etc.</li>
                      <li class="fragment"><b>PHP (Laravel)</b> ‚Äì Integra√ß√£o simples, abstra√ß√£o nativa, mas cada job depende do ciclo do PHP (precisa de supervisor para manter workers ativos).</li>
                      <li class="fragment"><b>Python (Django + Celery)</b> ‚Äì Muito robusto, suporta diversos backends (Redis, RabbitMQ), √≥timo para tarefas complexas, mas maior overhead.</li>
                      <li class="fragment"><b>Java (Spring Boot)</b> ‚Äì Altamente escal√°vel e confi√°vel, forte em sistemas corporativos, por√©m maior consumo de mem√≥ria e configura√ß√£o complexa.</li>
                    </ul>
                  </section>
                  
                  <section>
                    <h3>Pontos de compara√ß√£o</h3>
                    <ul>
                      <li class="fragment"><b>Velocidade</b>: Node.js e Go se destacam em filas leves e alto throughput.</li>
                      <li class="fragment"><b>Facilidade</b>: Laravel abstrai bem, Node.js com BullMQ √© simples, Celery em Python exige mais setup.</li>
                      <li class="fragment"><b>Escalabilidade</b>: Java/Spring e Node.js s√£o fortes em sistemas distribu√≠dos.</li>
                      <li class="fragment"><b>Ecossistema</b>: Python tem Celery, Node tem Bull/BullMQ, PHP/Laravel tem Queues nativas.</li>
                    </ul>
                  </section>
                  
                <section>
                <h2>Conclus√£o</h2>
                <p>Jobs, Queues, Notifications, Eventos e Scheduler tornam sua aplica√ß√£o robusta e escal√°vel.</p>
                </section>

                

				<section>
					Valeu o Boi, valeu o Vaqueiro

					<br><br><br>

					@alessandro_feitoza
					<br>

					https://linkedin.com/in/AlessandroFeitoza

                    <br>
                    https://alessandrofeitoza.github.io/slides

				</section>
			</div>
		</div>

		<script src="../../dist/reveal.js"></script>
		<script src="../../plugin/notes/notes.js"></script>
		<script src="../../plugin/markdown/markdown.js"></script>
		<script src="../../plugin/highlight/highlight.js"></script>
		<script>
			Reveal.initialize({
				hash: true,
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
